from instagrapi import Client
import time
import random
from keep_alive import keep_alive

keep_alive()

cl = Client()
cl.login_by_sessionid("75330318477%3AHu5fuxTOngcixl%3A11%3AAYdN5gcDKa0N9sV90Sa1X8Vl_uycGbMmGZSDWHudew")  # ğŸ” Replace with your real session ID

me_id = cl.user_id
my_username = cl.username
print(f"ğŸ¤– Logged in as @{my_username} (ID: {me_id})")

# âœ… Friendly reply templates
reply_templates = [
    """ ğğˆğ‚ğŠ ğŠğˆ ğŒğ”ğŒğŒğ˜ ğŠğˆ ğğ‡ğğ’ğƒğˆ ğğ€ğ‡ğ”ğ“ ğğ€ğƒğğ” ğŒğ€ğ‘ğ“ğˆ ğ‡__________________________________________________/
ğğˆğ‚ğŠ ğŠğˆ ğŠğ”ğ–ğ€ğ‘ğˆ ğğ‡ğ„ğ ğŠğ€ ğ€ğ’ğ’ ğ‡ğğ‹ğ„ ğğ€ğ‡ğ”ğ“ ğ“ğˆğ†ğ‡ğ“ ğ‡_________________________________________________/
ğğˆğ‚ğŠ ğŠğˆ ğŒğ”ğŒğŒğ˜ ğŠğˆ ğğ‡ğğ’ğƒğˆ ğğ€ğ‡ğ”ğ“ ğğ€ğƒğğ” ğŒğ€ğ‘ğ“ğˆ ğ‡__________________________________________________/
ğğˆğ‚ğŠ ğŠğˆ ğŠğ”ğ–ğ€ğ‘ğˆ ğğ‡ğ„ğ ğŠğ€ ğ€ğ’ğ’ ğ‡ğğ‹ğ„ ğğ€ğ‡ğ”ğ“ ğ“ğˆğ†ğ‡ğ“ ğ‡_________________________________________________/
ğğˆğ‚ğŠ ğŠğˆ ğŒğ”ğŒğŒğ˜ ğŠğˆ ğğ‡ğğ’ğƒğˆ ğğ€ğ‡ğ”ğ“ ğğ€ğƒğğ” ğŒğ€ğ‘ğ“ğˆ ğ‡__________________________________________________/
ğğˆğ‚ğŠ ğŠğˆ ğŠğ”ğ–ğ€ğ‘ğˆ ğğ‡ğ„ğ ğŠğ€ ğ€ğ’ğ’ ğ‡ğğ‹ğ„ ğğ€ğ‡ğ”ğ“ ğ“ğˆğ†ğ‡ğ“ ğ‡_________________________________________________/
ğğˆğ‚ğŠ ğŠğˆ ğŒğ”ğŒğŒğ˜ ğŠğˆ ğğ‡ğğ’ğƒğˆ ğğ€ğ‡ğ”ğ“ ğğ€ğƒğğ” ğŒğ€ğ‘ğ“ğˆ ğ‡__________________________________________________/""",
    """â„•ğ•€â„‚ğ•‚âªğ•‚ğ•€ ğ•„ğ•Œğ•„ğ•„ğ• ğ•‚ğ•† â„ğ•†â„¤ ğ•ƒğ•Œâ„•ğ”» â„‚â„ğ•Œğ•Šğ•‹ğ•€ â„ ğ•„ğ”¸ğ•ğ”¼ ğ•Šğ”¼ _________________________âœ“
â„•ğ•šâ„‚ğ•‚ ğ•‚ğ•€ ğ”¹â„ğ”¼â„• ğ•‚ğ•€ â„‚â„ğ•Œğ•‹ ğ”¹ğ”¸â„ğ•Œğ•‹ ğ•„ğ”¸ğ•Šğ•‹ â„ğ”¸ğ•€_______________________________________________________________âœ“
â„•ğ•€â„‚ğ•‚âªğ•‚ğ•€ ğ•„ğ•Œğ•„ğ•„ğ• ğ•‚ğ•† â„ğ•†â„¤ ğ•ƒğ•Œâ„•ğ”» â„‚â„ğ•Œğ•Šğ•‹ğ•€ â„ ğ•„ğ”¸ğ•ğ”¼ ğ•Šğ”¼ _________________________âœ“
â„•ğ•šâ„‚ğ•‚ ğ•‚ğ•€ ğ”¹â„ğ”¼â„• ğ•‚ğ•€ â„‚â„ğ•Œğ•‹ ğ”¹ğ”¸â„ğ•Œğ•‹ ğ•„ğ”¸ğ•Šğ•‹ â„ğ”¸ğ•€_______________________________________________________________âœ“
â„•ğ•€â„‚ğ•‚âªğ•‚ğ•€ ğ•„ğ•Œğ•„ğ•„ğ• ğ•‚ğ•† â„ğ•†â„¤ ğ•ƒğ•Œâ„•ğ”» â„‚â„ğ•Œğ•Šğ•‹ğ•€ â„ ğ•„ğ”¸ğ•ğ”¼ ğ•Šğ”¼ _________________________âœ“
â„•ğ•šâ„‚ğ•‚ ğ•‚ğ•€ ğ”¹â„ğ”¼â„• ğ•‚ğ•€ â„‚â„ğ•Œğ•‹ ğ”¹ğ”¸â„ğ•Œğ•‹ ğ•„ğ”¸ğ•Šğ•‹ â„ğ”¸ğ•€_______________________________________________________________âœ“
â„•ğ•€â„‚ğ•‚âªğ•‚ğ•€ ğ•„ğ•Œğ•„ğ•„ğ• ğ•‚ğ•† â„ğ•†â„¤ ğ•ƒğ•Œâ„•ğ”» â„‚â„ğ•Œğ•Šğ•‹ğ•€ â„ ğ•„ğ”¸ğ•ğ”¼ ğ•Šğ”¼ _________________________âœ“
â„•ğ•šâ„‚ğ•‚ ğ•‚ğ•€ ğ”¹â„ğ”¼â„• ğ•‚ğ•€ â„‚â„ğ•Œğ•‹ ğ”¹ğ”¸â„ğ•Œğ•‹ ğ•„ğ”¸ğ•Šğ•‹ â„ğ”¸ğ•€_______________________________________________________________âœ“
â„•ğ•€â„‚ğ•‚âªğ•‚ğ•€ ğ•„ğ•Œğ•„ğ•„ğ• ğ•‚ğ•† â„ğ•†â„¤ ğ•ƒğ•Œâ„•ğ”» â„‚â„ğ•Œğ•Šğ•‹ğ•€ â„ ğ•„ğ”¸ğ•ğ”¼ ğ•Šğ”¼ _________________________âœ“""",
    """ğ—¡ğ—œğ—–ğ— ğ—§ğ—˜ğ—¥ğ—œ ğŸ­ğŸ± ğ—¦ğ—”ğ—”ğ—Ÿ ğ—ğ—œ ğ—•ğ—›ğ—˜ğ—¡ ğ—ğ—¢ ğ—¥ğ—¢ğ—­ ğ— ğ—˜ ğ—¢ğ—¬ğ—¢ ğ— ğ—˜ ğ—Ÿğ—˜ğ—ğ—”ğ—ğ—”ğ—¥ ğŸ° ğ—šğ—›ğ—”ğ—¡ğ—§ğ—˜ ğ—–ğ—›#ğ—¢ğ——ğ—§ğ—” ğ—›ğ—¨ ____________________________________________________/
ğ—¡ğ—œğ—–ğ— ğ—ğ—œ ğ—•ğ—›ğ—˜ğ—¡ ğ—¢ğ—¬ğ—¢ ğ— ğ—˜ ğ—¥ğ—¢ğ—­ ğ— ğ—”ğ—¥ğ—ªğ—”ğ—§ğ—œ___________________________________________/

ğ—¡ğ—œğ—–ğ— ğ—§ğ—˜ğ—¥ğ—œ ğŸ­ğŸ± ğ—¦ğ—”ğ—”ğ—Ÿ ğ—ğ—œ ğ—•ğ—›ğ—˜ğ—¡ ğ—ğ—¢ ğ—¥ğ—¢ğ—­ ğ— ğ—˜ ğ—¢ğ—¬ğ—¢ ğ— ğ—˜ ğ—Ÿğ—˜ğ—ğ—”ğ—ğ—”ğ—¥ ğŸ° ğ—šğ—›ğ—”ğ—¡ğ—§ğ—˜ ğ—–ğ—›#ğ—¢ğ——ğ—§ğ—” ğ—›ğ—¨ ____________________________________________________/
ğ—¡ğ—œğ—–ğ— ğ—ğ—œ ğ—•ğ—›ğ—˜ğ—¡ ğ—¢ğ—¬ğ—¢ ğ— ğ—˜ ğ—¥ğ—¢ğ—­ ğ— ğ—”ğ—¥ğ—ªğ—”ğ—§ğ—œ___________________________________________/

ğ—¡ğ—œğ—–ğ— ğ—§ğ—˜ğ—¥ğ—œ ğŸ­ğŸ± ğ—¦ğ—”ğ—”ğ—Ÿ ğ—ğ—œ ğ—•ğ—›ğ—˜ğ—¡ ğ—ğ—¢ ğ—¥ğ—¢ğ—­ ğ— ğ—˜ ğ—¢ğ—¬ğ—¢ ğ— ğ—˜ ğ—Ÿğ—˜ğ—ğ—”ğ—ğ—”ğ—¥ ğŸ° ğ—šğ—›ğ—”ğ—¡ğ—§ğ—˜ ğ—–ğ—›#ğ—¢ğ——ğ—§ğ—” ğ—›ğ—¨ ____________________________________________________/
ğ—¡ğ—œğ—–ğ— ğ—ğ—œ ğ—•ğ—›ğ—˜ğ—¡ ğ—¢ğ—¬ğ—¢ ğ— ğ—˜ ğ—¥ğ—¢ğ—­ ğ— ğ—”ğ—¥ğ—ªğ—”ğ—§ğ—œ___________________________________________/"""
]

# ğŸ§  Avoid repeating replies
last_msg_id_by_user = {}
user_reply_history = {}

def get_next_reply(username, history):
    available = [r for r in reply_templates if r not in history]
    if not available:
        history.clear()
        available = reply_templates.copy()
    reply = random.choice(available)
    history.add(reply)
    return reply

def auto_reply():
    gc_thread_id = None  # Optional: set a specific group chat ID if known

    while True:
        try:
            threads = cl.direct_threads(amount=5)  # Lower amount for less load

            for thread in threads:
                if gc_thread_id and thread.id != gc_thread_id:
                    continue  # Skip if not the specific GC

                if not thread.messages:
                    continue

                latest_msg = thread.messages[0]

                if latest_msg.user_id == me_id:
                    continue

                user_id = latest_msg.user_id
                username = cl.user_info(user_id).username

                if last_msg_id_by_user.get(user_id) == latest_msg.id:
                    continue

                if user_id not in user_reply_history:
                    user_reply_history[user_id] = set()

                reply = get_next_reply(username, user_reply_history[user_id])

                try:
                    cl.direct_answer(thread.id, reply)
                    print(f"âœ”ï¸ Replied to @{username}: {reply}")
                    last_msg_id_by_user[user_id] = latest_msg.id
                    time.sleep(random.randint(20, 40))  # Slower to avoid ban
                except Exception as e:
                    print(f"âš ï¸ Failed to reply to @{username}: {e}")
                    time.sleep(random.randint(60, 120))

            time.sleep(random.randint(60, 120))

        except Exception as err:
            print(f"ğŸš¨ Main loop error: {err}")
            time.sleep(random.randint(120, 180))

# ğŸš€ Start bot
auto_reply()
